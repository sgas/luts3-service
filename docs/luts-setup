=== SGAS LUTS Installation Documentation ===

The LUTS service stores usage records in an underlaying database, and provides
a mechanism for retrieving aggregated information from these.


== Requirements ==

* Python 2.5 or later
* Twisted Core and Web (http://twistedmatrix.com/)
* PyOpenSSL (https://launchpad.net/pyopenssl)
* CouchDB or PostgreSQL as backend database.

Debian/Ubuntu:

Python comes stock
Packages: python-twisted python-twisted-web python-openssl

RedHat / CentOS

Typically the Python version is not new enough (Python 2.6 is recommended, 2.4
will NOT work, 2.5 might work but is not supported), Python and will have to be
installed manually with dependencies. See the redhat4-notes file for guides.

Packages: openssl-devel (for compiling pyopenssl)


== Database ==

See couchdb-setup for CouchDB setup or postgres-setup for PostgreSQL setup.
You only need to install one of them. The CouchDB backend is more well tested
than the PostgreSQL one, but PostgreSQL is probably the future for SGAS.


== NginX ==

As of version 3.3, it is recommended to use SGAS behind the NginX reverse
proxy, and is required for rendering views.

In order to keep backwards compatability, SGAS must be explicitely configured
to run behind a reverse proxy. This is done by setting:

reverseproxy=true

in the SGAS configuration file. Note that this will be included in the shipped
config file as of 3.3, but existing installations moving to an NginX setup,
will have to set it manually.

See docs/nginx-setup for how to setup NginX.


== Installation & Configuration ==

1. Unpack the tarball (you have probably already done this)
2. Run: python setup.py build
3. Run: sudo python setup.py install

Edit /etc/sgas.conf, the main settings you should worry about is:

# db.url - where to find the database. For CouchDB:
db=http://localhost:5984/usagerecords
For PostgreSQL:
db=localhost::sgas-db:db-user:db-password:

# authorization file
authzfile=/etc/sgas.authz

# level of depth to check hostname equivalence between ur machine name and insert identity
# e.g., a check depth of 2 will okay host1.example.org host2.example.org, where a depth 3
# will not. This mechanisms ensures that hosts do not register data for machines outside
# their domain. A value of 2 is the default and pretty much always work. A value of 3 is
# recommended, but does not always work.
check_depth=2

Hereafter edit /etc/sgas.authz to set which identities can perform which
actions. Subject names must in "", so a line would look like this:

"/O=Grid/O=NorduGrid/OU=ndgf.org/CN=Henrik Thostrup Jensen"     insert,view

which will allow insertion of usage records, and access to all views for the
identity. Initially, you will at least want to set who can insert usage
records.

